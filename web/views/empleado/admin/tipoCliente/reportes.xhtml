<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Reporte de Tipos de Cliente</title>
    <h:outputStylesheet library="bootstrap" name="css/bootstrap.min.css"/>
</h:head>

<h:body>

<f:metadata>
    <f:event type="preRenderView" listener="#{tipoClienteReporteBean.init}" />
</f:metadata>

<!-- CONTENEDOR PRINCIPAL -->
<div class="container mt-4">

    <!-- ENCABEZADO -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="mb-1">Reporte de Tipos de Cliente</h1>
            <h:outputText id="resumenFiltros" value="#{tipoClienteReporteBean.resumenFiltros}" styleClass="text-muted"/>
        </div>

        <!-- BOTÓN VOLVER -->
        <p:button value="Volver al Listado"
                  icon="pi pi-arrow-left"
                  outcome="index"
                  styleClass="btn btn-outline-secondary"/>
    </div> <!-- cierra d-flex -->

    <!-- FORM FILTROS -->
    <h:form id="formFiltros" styleClass="card mb-4 border-0 shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0">Filtros de Búsqueda</h5>
        </div>
        <div class="card-body">
            <div class="row g-3">

                <!-- ESTADO -->
                <div class="col-md-3">
                    <h:outputLabel value="Estado" styleClass="form-label fw-semibold"/>
                    <h:selectOneMenu value="#{tipoClienteReporteBean.estadoFiltro}" styleClass="form-select">
                        <f:selectItem itemLabel="-- Todos los estados --" itemValue="#{null}"/>
                        <f:selectItems value="#{tipoClienteReporteBean.estados}" var="e"
                                       itemLabel="#{e}" itemValue="#{e}"/>
                    </h:selectOneMenu>
                </div>

                <!-- FECHA DESDE -->
                <div class="col-md-3">
                    <h:outputLabel value="Fecha Desde" styleClass="form-label fw-semibold"/>
                    <p:datePicker value="#{tipoClienteReporteBean.fechaDesde}"
                                  pattern="dd/MM/yyyy" locale="es"
                                  styleClass="form-control"
                                  placeholder="dd/mm/aaaa" showIcon="true"/>
                </div>

                <!-- FECHA HASTA -->
                <div class="col-md-3">
                    <h:outputLabel value="Fecha Hasta" styleClass="form-label fw-semibold"/>
                    <p:datePicker value="#{tipoClienteReporteBean.fechaHasta}"
                                  pattern="dd/MM/yyyy" locale="es"
                                  styleClass="form-control"
                                  placeholder="dd/mm/aaaa" showIcon="true"/>
                </div>
            </div> <!-- cierra row -->

            <!-- BOTONES DE FILTRO -->
            <div class="mt-4 d-flex gap-2">
                <p:commandButton value="Aplicar Filtros"
                                 icon="pi pi-search"
                                 action="#{tipoClienteReporteBean.filtrarReporte}"
                                 update=":formExportes:tablaReporte :growl resumenFiltros"
                                 styleClass="btn btn-primary px-4"
                                 ajax="true"/>

                <p:commandButton value="Limpiar Filtros"
                                 icon="pi pi-times"
                                 action="#{tipoClienteReporteBean.limpiarFiltros}"
                                 update="formFiltros :formExportes:tablaReporte :growl resumenFiltros"
                                 styleClass="btn btn-outline-secondary"
                                 ajax="true"/>
            </div>
        </div>
    </h:form> <!-- cierra formFiltros -->

    <!-- MENSAJES -->
    <p:growl id="growl" showDetail="true" sticky="false" life="3000"/>

    <!-- FORM EXPORTACIÓN -->
    <h:form id="formExportes">
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="pi pi-download me-2"></i>
                    Exportar Resultados
                </h5>
            </div>
            <div class="card-body">
                <div class="btn-group">
                    <p:commandButton value="Exportar Excel" icon="pi pi-file-excel" styleClass="btn btn-success me-2" ajax="false">
                        <p:dataExporter type="xlsx" target="tablaReporte" fileName="reporte_tipos_cliente"
                                        preProcessor="#{tipoClienteReporteBean.preProcessExcel}"/>
                    </p:commandButton>

                    <p:commandButton value="Exportar PDF" icon="pi pi-file-pdf" styleClass="btn btn-danger me-2" ajax="false">
                        <p:dataExporter type="pdf" target="tablaReporte" fileName="reporte_tipos_cliente"
                                        pageOnly="true"
                                        preProcessor="#{tipoClienteReporteBean.preProcessPDF}"/>
                    </p:commandButton>

                    <p:commandButton value="Exportar CSV" icon="pi pi-file" styleClass="btn btn-secondary" ajax="false">
                        <p:dataExporter type="csv" target="tablaReporte" fileName="reporte_tipos_cliente"/>
                    </p:commandButton>
                </div>

                <small class="text-muted d-block mt-2">
                    Total registros a exportar: <strong>#{tipoClienteReporteBean.listaReporte.size()}</strong>
                </small>
            </div>
        </div>

        <!-- TABLA RESULTADOS -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="pi pi-list me-2"></i>
                    Resultados: #{tipoClienteReporteBean.listaReporte.size()} tipo(s) de cliente
                </h5>
            </div>
            <div class="card-body">
                <p:dataTable id="tablaReporte"
                             value="#{tipoClienteReporteBean.listaReporte}"
                             var="t"
                             paginator="true"
                             rows="10"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,20,50"
                             styleClass="table table-hover"
                             emptyMessage="No se encontraron tipos de cliente con los filtros aplicados">

                    <p:column headerText="ID" exportable="true">
                        #{t.idTipoCliente}
                    </p:column>

                    <p:column headerText="Nombre" exportable="true">
                        #{t.nombreTipo}
                    </p:column>

                    <p:column headerText="Estado" exportable="true">
                        #{t.estado}
                    </p:column>

                    <p:column headerText="Registro" exportable="true">
                        #{t.createdAt}
                    </p:column>

                    <!-- COLUMNA ACCIONES -->
                    <p:column headerText="Acciones" exportable="false" style="width:80px">
                        <p:button icon="pi pi-eye"
                                  title="Ver Detalles"
                                  outcome="/views/empleado/admin/tiposCliente/edit.xhtml"
                                  styleClass="btn btn-sm btn-outline-primary">
                            <f:param name="id" value="#{t.idTipoCliente}" />
                        </p:button>
                    </p:column>
                </p:dataTable>
            </div> <!-- cierra card-body de tabla -->
        </div> <!-- cierra card -->
    </h:form> <!-- cierra formExportes -->
</div> <!-- cierra container -->

<h:outputScript library="bootstrap" name="js/bootstrap.bundle.min.js"/>
</h:body>
</html>
