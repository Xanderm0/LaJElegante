<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
    <title>Reservar Mesa</title>
 <h:outputStylesheet library="bootstrap" name="css/bootstrap.min.css" />
    <style>
        .mesa-card {
            border-radius:10px;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            font-weight:bold;
            color:white;
        }
    </style>
</h:head>

<h:body>

<h:form id="formReserva">

<div class="container" style="min-height:70vh; display:flex; align-items:center;">
    <div class="row" style="width:100%;">
        <div class="col-md-10">
            <div class="p-4 rounded" style="background:#f2f2f2;">

                <div class="row">

                    <!-- IZQUIERDA MESAS -->
                    <div class="col-md-6">
                        <h4 class="mb-5 text-center">Mesas disponibles</h4>

                        <div class="row">

                            <!-- Mesas grandes -->
                            <div class="col-auto" style="display:flex; flex-direction:column; gap:20px; margin-right:20px; justify-content:center;">
                                <ui:repeat value="#{mesasBean.mesasGrandes}" var="mesa">
                                    <div class="mesa-card"
                                         style="height:90px; width:90px; background-color:#{mesa.activo ? '#28a745' : '#dc3545'}"
                                         onclick="mostrarInfo('#{mesa.idMesas}','#{mesa.numero}','#{mesa.activo}','#{mesa.capacidad}')">
                                        #{mesa.numero}
                                    </div>
                                </ui:repeat>
                            </div>

                            <!-- Mesas pequeñas -->
                            <div class="col d-flex align-items-center">
                                <div class="row" style="display:flex; flex-wrap:wrap; gap:20px; justify-content:center;">
                                    <ui:repeat value="#{mesasBean.mesasPequenas}" var="mesa">
                                        <div style="display:flex; justify-content:center;">
                                            <div class="mesa-card"
                                                 style="height:70px; width:70px; background-color:#{mesa.activo ? '#28a745' : '#dc3545'}"
                                                 onclick="mostrarInfo('#{mesa.idMesas}','#{mesa.numero}','#{mesa.activo}','#{mesa.capacidad}')">
                                                #{mesa.numero}
                                            </div>
                                        </div>
                                    </ui:repeat>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- DERECHA FORMULARIO -->
                    <div class="col-md-6" style="display:flex; flex-direction:column; justify-content:center;">
                        <h4 class="mb-3 text-center">Información de la mesa</h4>

                        <h:panelGroup id="panelInfo" layout="block" style="display:none;" class="card p-3">

                            <h5 id="mesaNombre" class="text-center"></h5>
                            <p><strong>Capacidad:</strong> <span id="mesaCapacidad"></span> personas</p>

                            <h:form id="formGuardar">

                                <h:inputHidden id="mesaId" value="#{reservaBean.idMesa}"/>

                                <div class="mb-3">
                                    <label>Fecha:</label>
                                    <p:calendar value="#{reservaBean.fecha}"
                                                pattern="yyyy-MM-dd"
                                                showIcon="true"
                                                required="true"/>
                                </div>

                                <div class="mb-3">
                                    <label>Hora:</label>
                                    <p:inputText value="#{reservaBean.hora}"
                                                 placeholder="HH:mm"
                                                 required="true"/>
                                </div>

                                <h5 class="mt-4">Cliente registrado (opcional)</h5>

                                <div class="mb-3">
                                    <label>Nombre:</label>
                                    <p:inputText value="#{reservaBean.nombreCliente}" />
                                </div>

                                <div class="mb-3">
                                    <label>Correo electrónico:</label>
                                    <p:inputText value="#{reservaBean.correoCliente}" />
                                </div>

                                <div class="text-center">
                                    <p:commandButton value="Reservar mesa"
                                                     action="#{reservaBean.guardarReserva}"
                                                     update="@form panelInfo growl"/>
                                </div>

                            </h:form>

                        </h:panelGroup>

                        <p:growl id="growl" showDetail="true"/>

                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

</h:form>

<script>
function mostrarInfo(id, numero, activo, capacidad) {
    document.getElementById("formReserva:panelInfo").style.display = 'block';
    document.getElementById("mesaNombre").innerText = "Mesa " + numero;
    document.getElementById("mesaCapacidad").innerText = capacidad;

    document.getElementById("formGuardar:mesaId").value = id;
}
</script>
<h:outputScript library="bootstrap" name="js/bootstrap.bundle.min.js" />
</h:body>
</html>