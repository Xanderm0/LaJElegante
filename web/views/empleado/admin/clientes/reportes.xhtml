<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Reporte de Clientes</title>
    <h:outputStylesheet library="bootstrap" name="css/bootstrap.min.css"/>
    
    <!-- Estilos internos -->
    <style>
        /* Contenedor principal */
        .reportes-container {
            margin-top: 2rem;
        }

        /* Encabezado */
        .reportes-header h1 {
            margin-bottom: 1rem;
        }

        /* Formulario de filtros */
        .form-filtros .form-label {
            font-weight: 500;
        }

        .form-filtros .btn {
            width: 100%;
        }

        /* Espaciado entre datePickers */
        .date-range-picker .form-control + .form-control {
            margin-top: 0.25rem;
        }

        /* Botones de exportación */
        .btn-export {
            margin-right: 0.5rem;
        }

        /* Mensajes */
        #mensajes {
            margin-bottom: 1rem;
        }

        /* Tabla de resultados */
        .table-resultados {
            table-layout: auto;
        }

        /* Alertas cuando no hay datos */
        .alert-info {
            margin-top: 1rem;
        }
    </style>
</h:head>


<h:body>

<f:metadata>
    <f:event type="preRenderView" listener="#{clienteReporteBean.init}" />
</f:metadata>

<!-- BOTÓN PARA VOLVER -->
<div class="mb-3">
    <p:button value="Volver al Listado"
              icon="pi pi-arrow-left"
              outcome="index"
              styleClass="btn btn-secondary"/>
</div>

<div class="container mt-4">

    <h1 class="mb-4">Reporte de Clientes</h1>

    <!-- ================== FILTROS ================== -->
    <h:form id="formFiltros" styleClass="row g-3 mb-4">

        <!-- ESTADO -->
        <div class="col-md-3">
            <h:outputLabel value="Estado" styleClass="form-label"/>
            <h:selectOneMenu value="#{clienteReporteBean.estadoFiltro}"
                             styleClass="form-select">
                <f:selectItem itemLabel="Todos" itemValue="#{null}"/>
                <f:selectItems value="#{clienteReporteBean.estados}"
                               var="e"
                               itemLabel="#{e.valor}"
                               itemValue="#{e}"/>
            </h:selectOneMenu>
        </div>

        <!-- TIPO CLIENTE (SIN CONVERTER) -->
        <div class="col-md-3">
            <h:outputLabel value="Tipo Cliente" styleClass="form-label"/>
            <h:selectOneMenu value="#{clienteReporteBean.idTipoClienteFiltro}"
                             styleClass="form-select">
                <f:selectItem itemLabel="Todos" itemValue="#{null}"/>
                <f:selectItems value="#{clienteReporteBean.listaTipos}"
                               var="t"
                               itemLabel="#{t.nombreTipo}"
                               itemValue="#{t.idTipoCliente}"/>
            </h:selectOneMenu>
        </div>

        <!-- FECHAS -->
        <div class="col-md-3">
            <h:outputLabel value="Rango de fechas" styleClass="form-label"/>
            <p:datePicker value="#{clienteReporteBean.fechaDesde}"
                          pattern="yyyy-MM-dd"
                          styleClass="form-control"/>
            <p:datePicker value="#{clienteReporteBean.fechaHasta}"
                          pattern="yyyy-MM-dd"
                          styleClass="form-control mt-1"/>
        </div>

        <!-- BOTÓN FILTRAR -->
        <div class="col-md-3 d-flex align-items-end">
            <p:commandButton value="Filtrar"
                             action="#{clienteReporteBean.filtrarReporte}"
                             update="tablaReporte mensajes"
                             styleClass="btn btn-primary"/>
        </div>

    </h:form>

    <!-- ================== EXPORTES ================== -->
    <h:form id="formExportes" class="mb-3">

        <p:commandButton value="Exportar Excel"
                         icon="pi pi-file-excel"
                         styleClass="btn btn-success me-2"
                         ajax="false">
            <p:dataExporter type="xlsx"
                            target="tablaReporte"
                            fileName="reporte_clientes"/>
        </p:commandButton>

        <p:commandButton value="Exportar PDF"
                         icon="pi pi-file-pdf"
                         styleClass="btn btn-danger"
                         ajax="false">
            <p:dataExporter type="pdf"
                            target="tablaReporte"
                            fileName="reporte_clientes"/>
        </p:commandButton>

    </h:form>

    <!-- ================== MENSAJES ================== -->
    <p:messages id="mensajes" closable="true">
        <p:autoUpdate/>
    </p:messages>

    <!-- ================== TABLA ================== -->
    <p:dataTable id="tablaReporte"
                 value="#{clienteReporteBean.listaReporte}"
                 var="c"
                 rendered="#{not empty clienteReporteBean.listaReporte}"
                 styleClass="table table-bordered">

        <p:column headerText="ID">
            <h:outputText value="#{c.idCliente}"/>
        </p:column>

        <p:column headerText="Nombre">
            <h:outputText value="#{c.nombre} #{c.apellido}"/>
        </p:column>

        <p:column headerText="Email">
            <h:outputText value="#{c.email}"/>
        </p:column>

        <p:column headerText="Tipo Cliente">
            <h:outputText value="#{c.tipoCliente.nombreTipo}"/>
        </p:column>

        <p:column headerText="Teléfono">
            <h:outputText value="#{c.prefijo} #{c.numTel}"/>
        </p:column>

        <p:column headerText="Estado">
            <h:outputText value="#{c.estado.valor}"/>
        </p:column>

    </p:dataTable>

    <h:panelGroup rendered="#{empty clienteReporteBean.listaReporte}">
        <div class="alert alert-info">
            No hay clientes que coincidan con los filtros.
        </div>
    </h:panelGroup>

</div>

<h:outputScript library="bootstrap" name="js/bootstrap.bundle.min.js"/>

</h:body>
</html>
