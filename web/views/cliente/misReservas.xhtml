<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/views/cliente/layouts/template.xhtml">
    
    <ui:define name="title">Mis Reservas - Hotel La J Elegante</ui:define>
    
    <ui:define name="content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">
                <i class="fas fa-calendar-alt me-2 text-primary"></i>
                Mis Reservas
            </h2>
            <div>
                <h:link outcome="/views/cliente/dashboard.xhtml" 
                       styleClass="btn btn-outline-secondary me-2">
                    <i class="fas fa-arrow-left me-1"></i> Volver
                </h:link>
            </div>
        </div>

        <!-- Pestañas -->
        <ul class="nav nav-tabs mb-4" id="reservasTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="habitaciones-tab" data-bs-toggle="tab" 
                        data-bs-target="#habitaciones" type="button" role="tab">
                    <i class="fas fa-bed me-1"></i> Habitaciones
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="restaurante-tab" data-bs-toggle="tab" 
                        data-bs-target="#restaurante" type="button" role="tab">
                    <i class="fas fa-utensils me-1"></i> Restaurante
                </button>
            </li>
        </ul>

        <div class="tab-content" id="reservasTabContent">
            <!-- Tab Habitaciones -->
            <div class="tab-pane fade show active" id="habitaciones" role="tabpanel">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Reservas de Habitación</h5>
                        <h:link outcome="/views/cliente/reservarHabitacion.xhtml" 
                               styleClass="btn btn-primary">
                            <i class="fas fa-plus-circle me-1"></i> Nueva Reserva
                        </h:link>
                    </div>
                    <div class="card-body">
                        <h:form id="formReservasHab">
                            <p:dataTable value="#{misReservasBean.reservasHabitacion}"
                                       var="reserva"
                                       emptyMessage="No tienes reservas de habitación"
                                       paginator="true" rows="10"
                                       styleClass="table table-hover">
                                
                                <p:column headerText="Habitación">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-bed text-primary me-2"></i>
                                        <span>#{reserva.habitacion.tipoHabitacion.nombre}</span>
                                    </div>
                                </p:column>
                                
                                <p:column headerText="Número">
                                    <strong>#{reserva.habitacion.numeroHabitacion}</strong>
                                </p:column>
                                
                                <p:column headerText="Check-in">
                                    <h:outputText value="#{reserva.detalleReservaHabitacion.fechaInicio}">
                                        <f:convertDateTime pattern="dd/MM/yyyy" />
                                    </h:outputText>
                                </p:column>
                                
                                <p:column headerText="Check-out">
                                    <h:outputText value="#{reserva.detalleReservaHabitacion.fechaFin}">
                                        <f:convertDateTime pattern="dd/MM/yyyy" />
                                    </h:outputText>
                                </p:column>
                                
                                <p:column headerText="Personas">
                                    #{reserva.detalleReservaHabitacion.cantidadPersonas}
                                </p:column>
                                
                                <p:column headerText="Estado">
                                    <span class="badge bg-success">Confirmada</span>
                                </p:column>
                                
                                <p:column headerText="Acciones" style="width: 120px;">
                                    <div class="btn-group btn-group-sm">
                                        <p:commandButton icon="fas fa-eye" 
                                                       styleClass="btn btn-outline-info"
                                                       title="Ver detalles">
                                            <f:setPropertyActionListener target="#{misReservasBean.reservaSeleccionada}" 
                                                                       value="#{reserva}" />
                                        </p:commandButton>
                                        <p:commandButton icon="fas fa-times" 
                                                       styleClass="btn btn-outline-danger"
                                                       title="Cancelar reserva"
                                                       onclick="return confirm('¿Está seguro de cancelar esta reserva?')">
                                        </p:commandButton>
                                    </div>
                                </p:column>
                            </p:dataTable>
                        </h:form>
                    </div>
                </div>
            </div>

            <!-- Tab Restaurante -->
            <div class="tab-pane fade" id="restaurante" role="tabpanel">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Reservas de Restaurante</h5>
                        <h:link outcome="/views/cliente/reservarRestaurante.xhtml" 
                               styleClass="btn btn-success">
                            <i class="fas fa-plus-circle me-1"></i> Nueva Reserva
                        </h:link>
                    </div>
                    <div class="card-body">
                        <h:form id="formReservasRes">
                            <p:dataTable value="#{misReservasBean.reservasRestaurante}"
                                       var="reserva"
                                       emptyMessage="No tienes reservas de restaurante"
                                       paginator="true" rows="10"
                                       styleClass="table table-hover">
                                
                                <p:column headerText="Mesa">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-utensils text-success me-2"></i>
                                        <span>Mesa #{reserva.mesa.numero}</span>
                                    </div>
                                </p:column>
                                
                                <p:column headerText="Fecha">
                                    <h:outputText value="#{reserva.fechaReserva}">
                                        <f:convertDateTime pattern="dd/MM/yyyy" />
                                    </h:outputText>
                                </p:column>
                                
                                <p:column headerText="Hora">
                                    <h:outputText value="#{reserva.horaReserva}">
                                        <f:convertDateTime pattern="HH:mm" />
                                    </h:outputText>
                                </p:column>
                                
                                <p:column headerText="Personas">
                                    #{reserva.numeroPersonas}
                                </p:column>
                                
                                <p:column headerText="Estado">
                                    <span class="badge bg-success">Confirmada</span>
                                </p:column>
                                
                                <p:column headerText="Acciones" style="width: 120px;">
                                    <div class="btn-group btn-group-sm">
                                        <p:commandButton icon="fas fa-eye" 
                                                       styleClass="btn btn-outline-info"
                                                       title="Ver detalles">
                                        </p:commandButton>
                                        <p:commandButton icon="fas fa-times" 
                                                       styleClass="btn btn-outline-danger"
                                                       title="Cancelar reserva"
                                                       onclick="return confirm('¿Está seguro de cancelar esta reserva?')">
                                        </p:commandButton>
                                    </div>
                                </p:column>
                            </p:dataTable>
                        </h:form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Script para activar tabs -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var triggerTabList = [].slice.call(document.querySelectorAll('#reservasTab button'));
                triggerTabList.forEach(function (triggerEl) {
                    var tabTrigger = new bootstrap.Tab(triggerEl);
                    triggerEl.addEventListener('click', function (event) {
                        event.preventDefault();
                        tabTrigger.show();
                    });
                });
            });
        </script>
    </ui:define>
</ui:composition>